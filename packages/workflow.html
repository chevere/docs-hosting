<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Workflow | Chevere</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="icon" href="/logo.png">
    <link rel="apple-touch-icon" href="/logo.png">
    <meta name="description" content="High quality library for building server-side software">
    <meta property="og:site_name" content="Chevere">
    <meta property="og:title" content="Workflow">
    <meta property="og:type" content="website">
    <meta property="og:url" content="/packages/workflow.html">
    <meta name="twitter:title" content="Workflow">
    <meta name="twitter:url" content="/packages/workflow.html">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileColor" content="#000000">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <link rel="preload" href="/assets/css/0.styles.0f7b7e19.css" as="style"><link rel="preload" href="/assets/js/app.d34653bd.js" as="script"><link rel="preload" href="/assets/js/2.b3d98ebb.js" as="script"><link rel="preload" href="/assets/js/1.cbf95cfe.js" as="script"><link rel="preload" href="/assets/js/52.78353147.js" as="script"><link rel="prefetch" href="/assets/js/10.ce1ffa88.js"><link rel="prefetch" href="/assets/js/11.19c30390.js"><link rel="prefetch" href="/assets/js/12.63244053.js"><link rel="prefetch" href="/assets/js/13.7278834f.js"><link rel="prefetch" href="/assets/js/14.ddbbd723.js"><link rel="prefetch" href="/assets/js/15.951b87f8.js"><link rel="prefetch" href="/assets/js/16.22953f39.js"><link rel="prefetch" href="/assets/js/17.37cdd360.js"><link rel="prefetch" href="/assets/js/18.ac720a26.js"><link rel="prefetch" href="/assets/js/19.265c60db.js"><link rel="prefetch" href="/assets/js/20.b5e0f461.js"><link rel="prefetch" href="/assets/js/21.f8a5d0fc.js"><link rel="prefetch" href="/assets/js/22.c7db5a2e.js"><link rel="prefetch" href="/assets/js/23.a460b2d2.js"><link rel="prefetch" href="/assets/js/24.86dbe629.js"><link rel="prefetch" href="/assets/js/25.c73b6e9d.js"><link rel="prefetch" href="/assets/js/26.f000397d.js"><link rel="prefetch" href="/assets/js/27.b31a4070.js"><link rel="prefetch" href="/assets/js/28.496ebfd9.js"><link rel="prefetch" href="/assets/js/29.05fbe802.js"><link rel="prefetch" href="/assets/js/3.f1e808b9.js"><link rel="prefetch" href="/assets/js/30.71265950.js"><link rel="prefetch" href="/assets/js/31.e70afbfe.js"><link rel="prefetch" href="/assets/js/32.cfb0ea4f.js"><link rel="prefetch" href="/assets/js/33.1a8363dd.js"><link rel="prefetch" href="/assets/js/34.fffa1c28.js"><link rel="prefetch" href="/assets/js/35.34dbf8b8.js"><link rel="prefetch" href="/assets/js/36.7dadbdad.js"><link rel="prefetch" href="/assets/js/37.04acf26c.js"><link rel="prefetch" href="/assets/js/38.445c0cf6.js"><link rel="prefetch" href="/assets/js/39.8f93d2ef.js"><link rel="prefetch" href="/assets/js/4.17348ca1.js"><link rel="prefetch" href="/assets/js/40.17367ac9.js"><link rel="prefetch" href="/assets/js/41.84fecf3f.js"><link rel="prefetch" href="/assets/js/42.f05895a0.js"><link rel="prefetch" href="/assets/js/43.3f60a48f.js"><link rel="prefetch" href="/assets/js/44.bf84ff95.js"><link rel="prefetch" href="/assets/js/45.707dd8ea.js"><link rel="prefetch" href="/assets/js/46.e9f9b4e0.js"><link rel="prefetch" href="/assets/js/47.f72248a4.js"><link rel="prefetch" href="/assets/js/48.6d6f2739.js"><link rel="prefetch" href="/assets/js/49.26c317d9.js"><link rel="prefetch" href="/assets/js/5.e159fa16.js"><link rel="prefetch" href="/assets/js/50.fc323f0d.js"><link rel="prefetch" href="/assets/js/51.dff8e62e.js"><link rel="prefetch" href="/assets/js/53.b63a6e35.js"><link rel="prefetch" href="/assets/js/54.229b25c6.js"><link rel="prefetch" href="/assets/js/6.e3ac936f.js"><link rel="prefetch" href="/assets/js/7.8fcd73e7.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.92fa0d62.js">
    <link rel="stylesheet" href="/assets/css/0.styles.0f7b7e19.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/logo.svg" alt="Chevere" class="logo"> <span class="site-name can-hide">Chevere</span></a> <div class="links"><form id="search-form" role="search" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <nav class="nav-links can-hide"><div class="nav-item"><a href="/introduction/" class="nav-link">
  Intro
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Packages Menu" class="dropdown-title"><span class="title">Packages</span> <span class="arrow down"></span></button> <button type="button" aria-label="Packages Menu" class="mobile-dropdown-title"><span class="title">Packages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/packages/action.html" class="nav-link">
  Action
</a></li><li class="dropdown-item"><!----> <a href="/packages/container.html" class="nav-link">
  Container
</a></li><li class="dropdown-item"><!----> <a href="/packages/data-structure.html" class="nav-link">
  DataStructure
</a></li><li class="dropdown-item"><!----> <a href="/packages/filesystem.html" class="nav-link">
  Filesystem
</a></li><li class="dropdown-item"><!----> <a href="/packages/http.html" class="nav-link">
  Http
</a></li><li class="dropdown-item"><!----> <a href="/packages/message.html" class="nav-link">
  Message
</a></li><li class="dropdown-item"><!----> <a href="/packages/parameter.html" class="nav-link">
  Parameter
</a></li><li class="dropdown-item"><!----> <a href="/packages/regex.html" class="nav-link">
  Regex
</a></li><li class="dropdown-item"><!----> <a href="/packages/router.html" class="nav-link">
  Router
</a></li><li class="dropdown-item"><!----> <a href="/packages/schwager.html" class="nav-link">
  Schwager
</a></li><li class="dropdown-item"><!----> <a href="/packages/sql2p.html" class="nav-link">
  SQL2P
</a></li><li class="dropdown-item"><!----> <a href="/packages/standard.html" class="nav-link">
  Standard
</a></li><li class="dropdown-item"><!----> <a href="/packages/throwable-handler.html" class="nav-link">
  ThrowableHandler
</a></li><li class="dropdown-item"><!----> <a href="/packages/trace.html" class="nav-link">
  Trace
</a></li><li class="dropdown-item"><!----> <a href="/packages/var-dump.html" class="nav-link">
  VarDump
</a></li><li class="dropdown-item"><!----> <a href="/packages/var-support.html" class="nav-link">
  VarSupport
</a></li><li class="dropdown-item"><!----> <a href="/packages/workflow.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  Workflow
</a></li><li class="dropdown-item"><!----> <a href="/packages/writer.html" class="nav-link">
  Writer
</a></li><li class="dropdown-item"><!----> <a href="/packages/xrdebug.html" class="nav-link">
  xrDebug
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Dev Menu" class="dropdown-title"><span class="title">Dev</span> <span class="arrow down"></span></button> <button type="button" aria-label="Dev Menu" class="mobile-dropdown-title"><span class="title">Dev</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          Standard
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/developer/standard/quality.html" class="nav-link">
  Quality
</a></li><li class="dropdown-subitem"><a href="/developer/standard/coding.html" class="nav-link">
  Coding
</a></li><li class="dropdown-subitem"><a href="/developer/standard/immutability.html" class="nav-link">
  Immutability
</a></li><li class="dropdown-subitem"><a href="/developer/standard/testing.html" class="nav-link">
  Testing
</a></li></ul></li><li class="dropdown-item"><h4>
          Spec
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/developer/spec/interfaces.html" class="nav-link">
  Interfaces
</a></li><li class="dropdown-subitem"><a href="/developer/spec/components.html" class="nav-link">
  Components
</a></li></ul></li><li class="dropdown-item"><h4>
          Environment
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/developer/environment/system.html" class="nav-link">
  System
</a></li><li class="dropdown-subitem"><a href="/developer/environment/workspace.html" class="nav-link">
  Workspace
</a></li></ul></li></ul></div></div> <a href="https://github.com/chevere/chevere" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/introduction/" class="nav-link">
  Intro
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Packages Menu" class="dropdown-title"><span class="title">Packages</span> <span class="arrow down"></span></button> <button type="button" aria-label="Packages Menu" class="mobile-dropdown-title"><span class="title">Packages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/packages/action.html" class="nav-link">
  Action
</a></li><li class="dropdown-item"><!----> <a href="/packages/container.html" class="nav-link">
  Container
</a></li><li class="dropdown-item"><!----> <a href="/packages/data-structure.html" class="nav-link">
  DataStructure
</a></li><li class="dropdown-item"><!----> <a href="/packages/filesystem.html" class="nav-link">
  Filesystem
</a></li><li class="dropdown-item"><!----> <a href="/packages/http.html" class="nav-link">
  Http
</a></li><li class="dropdown-item"><!----> <a href="/packages/message.html" class="nav-link">
  Message
</a></li><li class="dropdown-item"><!----> <a href="/packages/parameter.html" class="nav-link">
  Parameter
</a></li><li class="dropdown-item"><!----> <a href="/packages/regex.html" class="nav-link">
  Regex
</a></li><li class="dropdown-item"><!----> <a href="/packages/router.html" class="nav-link">
  Router
</a></li><li class="dropdown-item"><!----> <a href="/packages/schwager.html" class="nav-link">
  Schwager
</a></li><li class="dropdown-item"><!----> <a href="/packages/sql2p.html" class="nav-link">
  SQL2P
</a></li><li class="dropdown-item"><!----> <a href="/packages/standard.html" class="nav-link">
  Standard
</a></li><li class="dropdown-item"><!----> <a href="/packages/throwable-handler.html" class="nav-link">
  ThrowableHandler
</a></li><li class="dropdown-item"><!----> <a href="/packages/trace.html" class="nav-link">
  Trace
</a></li><li class="dropdown-item"><!----> <a href="/packages/var-dump.html" class="nav-link">
  VarDump
</a></li><li class="dropdown-item"><!----> <a href="/packages/var-support.html" class="nav-link">
  VarSupport
</a></li><li class="dropdown-item"><!----> <a href="/packages/workflow.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  Workflow
</a></li><li class="dropdown-item"><!----> <a href="/packages/writer.html" class="nav-link">
  Writer
</a></li><li class="dropdown-item"><!----> <a href="/packages/xrdebug.html" class="nav-link">
  xrDebug
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Dev Menu" class="dropdown-title"><span class="title">Dev</span> <span class="arrow down"></span></button> <button type="button" aria-label="Dev Menu" class="mobile-dropdown-title"><span class="title">Dev</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          Standard
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/developer/standard/quality.html" class="nav-link">
  Quality
</a></li><li class="dropdown-subitem"><a href="/developer/standard/coding.html" class="nav-link">
  Coding
</a></li><li class="dropdown-subitem"><a href="/developer/standard/immutability.html" class="nav-link">
  Immutability
</a></li><li class="dropdown-subitem"><a href="/developer/standard/testing.html" class="nav-link">
  Testing
</a></li></ul></li><li class="dropdown-item"><h4>
          Spec
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/developer/spec/interfaces.html" class="nav-link">
  Interfaces
</a></li><li class="dropdown-subitem"><a href="/developer/spec/components.html" class="nav-link">
  Components
</a></li></ul></li><li class="dropdown-item"><h4>
          Environment
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/developer/environment/system.html" class="nav-link">
  System
</a></li><li class="dropdown-subitem"><a href="/developer/environment/workspace.html" class="nav-link">
  Workspace
</a></li></ul></li></ul></div></div> <a href="https://github.com/chevere/chevere" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Workflow</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/packages/workflow.html#summary" class="sidebar-link">Summary</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/packages/workflow.html#installing" class="sidebar-link">Installing</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/packages/workflow.html#quick-start" class="sidebar-link">Quick Start</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/packages/workflow.html#core-concepts" class="sidebar-link">Core Concepts</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/packages/workflow.html#how-it-works" class="sidebar-link">How It Works</a></li></ul></li><li><a href="/packages/workflow.html#functions-reference" class="sidebar-link">Functions Reference</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/packages/workflow.html#jobs" class="sidebar-link">Jobs</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/packages/workflow.html#creating-jobs-with-closures" class="sidebar-link">Creating Jobs with Closures</a></li><li class="sidebar-sub-header"><a href="/packages/workflow.html#creating-jobs-with-action-classes" class="sidebar-link">Creating Jobs with Action Classes</a></li><li class="sidebar-sub-header"><a href="/packages/workflow.html#sync-vs-async-jobs" class="sidebar-link">Sync vs Async Jobs</a></li><li class="sidebar-sub-header"><a href="/packages/workflow.html#job-arguments" class="sidebar-link">Job Arguments</a></li></ul></li><li><a href="/packages/workflow.html#variables" class="sidebar-link">Variables</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/packages/workflow.html#responses" class="sidebar-link">Responses</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/packages/workflow.html#accessing-nested-response-keys" class="sidebar-link">Accessing Nested Response Keys</a></li></ul></li><li><a href="/packages/workflow.html#execution-graph" class="sidebar-link">Execution Graph</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/packages/workflow.html#running-workflows" class="sidebar-link">Running Workflows</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/packages/workflow.html#accessing-responses" class="sidebar-link">Accessing Responses</a></li><li class="sidebar-sub-header"><a href="/packages/workflow.html#check-skipped-jobs" class="sidebar-link">Check Skipped Jobs</a></li></ul></li><li><a href="/packages/workflow.html#conditional-execution" class="sidebar-link">Conditional Execution</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/packages/workflow.html#explicit-dependencies" class="sidebar-link">Explicit Dependencies</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/packages/workflow.html#retry-policy" class="sidebar-link">Retry Policy</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/packages/workflow.html#exception-handling" class="sidebar-link">Exception Handling</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/packages/workflow.html#using-workflowtrait" class="sidebar-link">Using WorkflowTrait</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/packages/workflow.html#testing" class="sidebar-link">Testing</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/packages/workflow.html#testing-actions" class="sidebar-link">Testing Actions</a></li><li class="sidebar-sub-header"><a href="/packages/workflow.html#testing-workflow-graph" class="sidebar-link">Testing Workflow Graph</a></li><li class="sidebar-sub-header"><a href="/packages/workflow.html#testing-responses" class="sidebar-link">Testing Responses</a></li><li class="sidebar-sub-header"><a href="/packages/workflow.html#testing-exceptions" class="sidebar-link">Testing Exceptions</a></li></ul></li><li><a href="/packages/workflow.html#real-world-examples" class="sidebar-link">Real-World Examples</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/packages/workflow.html#image-processing-pipeline" class="sidebar-link">Image Processing Pipeline</a></li><li class="sidebar-sub-header"><a href="/packages/workflow.html#user-registration-flow" class="sidebar-link">User Registration Flow</a></li><li class="sidebar-sub-header"><a href="/packages/workflow.html#conditional-processing" class="sidebar-link">Conditional Processing</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="workflow"><a href="#workflow" class="header-anchor">#</a> Workflow</h1> <h2 id="summary"><a href="#summary" class="header-anchor">#</a> Summary</h2> <p><strong>Chevere Workflow</strong> is a PHP library for building and executing multi-step procedures with automatic dependency resolution. Define independent jobs that can run synchronously or asynchronously, pass data between them using typed responses, and let the engine handle execution order automatically.</p> <p><strong>Key features:</strong></p> <ul><li><strong>Declarative job definitions</strong> - Define what to do, not how to orchestrate it</li> <li><strong>Automatic dependency graph</strong> - Jobs execute in optimal order based on their dependencies</li> <li><strong>Sync and async execution</strong> - Mix blocking and non-blocking jobs freely</li> <li><strong>Type-safe responses</strong> - Access job outputs with full type safety</li> <li><strong>Conditional execution</strong> - Run jobs based on variables or previous responses</li> <li><strong>Built-in retry policies</strong> - Handle transient failures automatically</li> <li><strong>Testable components</strong> - Each job is independently testable</li></ul> <h2 id="installing"><a href="#installing" class="header-anchor">#</a> Installing</h2> <p>Workflow is available through <a href="https://packagist.org/packages/chevere/workflow" target="_blank" rel="noopener noreferrer">Packagist<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> and the repository source is at <a href="https://github.com/chevere/workflow" target="_blank" rel="noopener noreferrer">chevere/workflow<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">composer</span> require chevere/workflow
</code></pre></div><h2 id="quick-start"><a href="#quick-start" class="header-anchor">#</a> Quick Start</h2> <p>Here's a minimal example to get you started:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">function</span> Chevere\Workflow\<span class="token punctuation">{</span>workflow<span class="token punctuation">,</span> sync<span class="token punctuation">,</span> variable<span class="token punctuation">,</span> run<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 1. Define a workflow with jobs</span>
<span class="token variable">$workflow</span> <span class="token operator">=</span> <span class="token function">workflow</span><span class="token punctuation">(</span>
    <span class="token argument-name">greet</span><span class="token punctuation">:</span> <span class="token function">sync</span><span class="token punctuation">(</span>
        <span class="token keyword">fn</span><span class="token punctuation">(</span><span class="token keyword type-hint">string</span> <span class="token variable">$name</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword return-type">string</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;Hello, <span class="token interpolation"><span class="token punctuation">{</span><span class="token variable">$name</span><span class="token punctuation">}</span></span>!&quot;</span><span class="token punctuation">,</span>
        <span class="token argument-name">name</span><span class="token punctuation">:</span> <span class="token function">variable</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'username'</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 2. Run with variables</span>
<span class="token variable">$result</span> <span class="token operator">=</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token variable">$workflow</span><span class="token punctuation">,</span> <span class="token argument-name">username</span><span class="token punctuation">:</span> <span class="token string single-quoted-string">'World'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 3. Get typed responses</span>
<span class="token keyword">echo</span> <span class="token variable">$result</span><span class="token operator">-&gt;</span><span class="token function">response</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'greet'</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token keyword type-declaration">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Output: Hello, World!</span>
</code></pre></div><h2 id="core-concepts"><a href="#core-concepts" class="header-anchor">#</a> Core Concepts</h2> <p>Workflow is built around four main concepts:</p> <table><thead><tr><th>Concept</th> <th>Description</th></tr></thead> <tbody><tr><td><strong>Job</strong></td> <td>A unit of work (Action class or Closure) that produces a response</td></tr> <tr><td><strong>Variable</strong></td> <td>External input provided when running the workflow</td></tr> <tr><td><strong>Response</strong></td> <td>Reference to output from a previous job</td></tr> <tr><td><strong>Graph</strong></td> <td>Automatic execution order based on job dependencies</td></tr></tbody></table> <h3 id="how-it-works"><a href="#how-it-works" class="header-anchor">#</a> How It Works</h3> <ol><li>You define jobs using <code>sync()</code> or <code>async()</code> functions</li> <li>Jobs declare their inputs: literal values, <code>variable()</code> references, or <code>response()</code> from other jobs</li> <li>The engine builds a dependency graph automatically</li> <li>Jobs execute in optimal order (parallel when possible)</li> <li>Access typed responses after execution</li></ol> <h2 id="functions-reference"><a href="#functions-reference" class="header-anchor">#</a> Functions Reference</h2> <table><thead><tr><th>Function</th> <th>Purpose</th></tr></thead> <tbody><tr><td><code>workflow()</code></td> <td>Create a workflow from named jobs</td></tr> <tr><td><code>sync()</code></td> <td>Create a synchronous (blocking) job</td></tr> <tr><td><code>async()</code></td> <td>Create an asynchronous (non-blocking) job</td></tr> <tr><td><code>variable()</code></td> <td>Declare a runtime variable</td></tr> <tr><td><code>response()</code></td> <td>Reference another job's output</td></tr> <tr><td><code>run()</code></td> <td>Execute a workflow with variables</td></tr></tbody></table> <hr> <h2 id="jobs"><a href="#jobs" class="header-anchor">#</a> Jobs</h2> <p>Jobs are the building blocks of a workflow. Each job wraps an executable unit (Action or Closure) and declares its input arguments.</p> <h3 id="creating-jobs-with-closures"><a href="#creating-jobs-with-closures" class="header-anchor">#</a> Creating Jobs with Closures</h3> <p>Use closures for simple, inline operations:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">function</span> Chevere\Workflow\<span class="token punctuation">{</span>workflow<span class="token punctuation">,</span> sync<span class="token punctuation">,</span> async<span class="token punctuation">,</span> variable<span class="token punctuation">,</span> response<span class="token punctuation">,</span> run<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token variable">$workflow</span> <span class="token operator">=</span> <span class="token function">workflow</span><span class="token punctuation">(</span>
    <span class="token comment">// Simple calculation</span>
    add<span class="token punctuation">:</span> <span class="token function">sync</span><span class="token punctuation">(</span>
        <span class="token keyword">fn</span><span class="token punctuation">(</span><span class="token keyword type-hint">int</span> <span class="token variable">$a</span><span class="token punctuation">,</span> <span class="token keyword type-hint">int</span> <span class="token variable">$b</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword return-type">int</span> <span class="token operator">=&gt;</span> <span class="token variable">$a</span> <span class="token operator">+</span> <span class="token variable">$b</span><span class="token punctuation">,</span>
        <span class="token argument-name">a</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
        <span class="token argument-name">b</span><span class="token punctuation">:</span> <span class="token function">variable</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'number'</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment">// Format the result</span>
    format<span class="token punctuation">:</span> <span class="token function">sync</span><span class="token punctuation">(</span>
        <span class="token keyword">fn</span><span class="token punctuation">(</span><span class="token keyword type-hint">int</span> <span class="token variable">$sum</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword return-type">string</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;Sum: <span class="token interpolation"><span class="token punctuation">{</span><span class="token variable">$sum</span><span class="token punctuation">}</span></span>&quot;</span><span class="token punctuation">,</span>
        <span class="token argument-name">sum</span><span class="token punctuation">:</span> <span class="token function">response</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'add'</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$result</span> <span class="token operator">=</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token variable">$workflow</span><span class="token punctuation">,</span> <span class="token argument-name">number</span><span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">echo</span> <span class="token variable">$result</span><span class="token operator">-&gt;</span><span class="token function">response</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'format'</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token keyword type-declaration">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Sum: 15</span>
</code></pre></div><h3 id="creating-jobs-with-action-classes"><a href="#creating-jobs-with-action-classes" class="header-anchor">#</a> Creating Jobs with Action Classes</h3> <p>For complex or reusable logic, use <a href="https://chevere.org/packages/action" target="_blank" rel="noopener noreferrer">Action<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> classes:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">Chevere<span class="token punctuation">\</span>Action<span class="token punctuation">\</span>Action</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name-definition class-name">FetchUser</span> <span class="token keyword">extends</span> <span class="token class-name">Action</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__invoke</span><span class="token punctuation">(</span><span class="token keyword type-hint">int</span> <span class="token variable">$userId</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword return-type">array</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Fetch user from database</span>
        <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span> <span class="token operator">=&gt;</span> <span class="token variable">$userId</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'name'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'John'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'email'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'john@example.com'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name-definition class-name">SendEmail</span> <span class="token keyword">extends</span> <span class="token class-name">Action</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__invoke</span><span class="token punctuation">(</span><span class="token keyword type-hint">string</span> <span class="token variable">$email</span><span class="token punctuation">,</span> <span class="token keyword type-hint">string</span> <span class="token variable">$subject</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword return-type">bool</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Send email logic</span>
        <span class="token keyword">return</span> <span class="token constant boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$workflow</span> <span class="token operator">=</span> <span class="token function">workflow</span><span class="token punctuation">(</span>
    <span class="token argument-name">user</span><span class="token punctuation">:</span> <span class="token function">sync</span><span class="token punctuation">(</span>
        <span class="token class-name static-context">FetchUser</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">,</span>
        <span class="token argument-name">userId</span><span class="token punctuation">:</span> <span class="token function">variable</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token argument-name">notify</span><span class="token punctuation">:</span> <span class="token function">sync</span><span class="token punctuation">(</span>
        <span class="token class-name static-context">SendEmail</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">,</span>
        <span class="token argument-name">email</span><span class="token punctuation">:</span> <span class="token function">response</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'user'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'email'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token argument-name">subject</span><span class="token punctuation">:</span> <span class="token string single-quoted-string">'Welcome!'</span>
    <span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$result</span> <span class="token operator">=</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token variable">$workflow</span><span class="token punctuation">,</span> <span class="token argument-name">id</span><span class="token punctuation">:</span> <span class="token number">123</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="sync-vs-async-jobs"><a href="#sync-vs-async-jobs" class="header-anchor">#</a> Sync vs Async Jobs</h3> <p><strong>Synchronous jobs</strong> (<code>sync</code>) block execution until complete. Use for operations that must run in sequence:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token function">workflow</span><span class="token punctuation">(</span>
    <span class="token argument-name">first</span><span class="token punctuation">:</span> <span class="token function">sync</span><span class="token punctuation">(</span><span class="token class-name static-context">ActionA</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment">// Runs first</span>
    second<span class="token punctuation">:</span> <span class="token function">sync</span><span class="token punctuation">(</span><span class="token class-name static-context">ActionB</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// Waits for first</span>
    third<span class="token punctuation">:</span> <span class="token function">sync</span><span class="token punctuation">(</span><span class="token class-name static-context">ActionC</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment">// Waits for second</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Graph: first → second → third</span>
</code></pre></div><p><strong>Asynchronous jobs</strong> (<code>async</code>) run concurrently when they have no dependencies:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token function">workflow</span><span class="token punctuation">(</span>
    <span class="token argument-name">resize1</span><span class="token punctuation">:</span> <span class="token function">async</span><span class="token punctuation">(</span><span class="token class-name static-context">ResizeImage</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token argument-name">size</span><span class="token punctuation">:</span> <span class="token string single-quoted-string">'thumb'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token argument-name">resize2</span><span class="token punctuation">:</span> <span class="token function">async</span><span class="token punctuation">(</span><span class="token class-name static-context">ResizeImage</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token argument-name">size</span><span class="token punctuation">:</span> <span class="token string single-quoted-string">'medium'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token argument-name">resize3</span><span class="token punctuation">:</span> <span class="token function">async</span><span class="token punctuation">(</span><span class="token class-name static-context">ResizeImage</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token argument-name">size</span><span class="token punctuation">:</span> <span class="token string single-quoted-string">'large'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token argument-name">store</span><span class="token punctuation">:</span> <span class="token function">sync</span><span class="token punctuation">(</span><span class="token class-name static-context">StoreFiles</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token argument-name">files</span><span class="token punctuation">:</span> <span class="token function">response</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'resize1'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">...</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Graph: [resize1, resize2, resize3] → store</span>
</code></pre></div><h3 id="job-arguments"><a href="#job-arguments" class="header-anchor">#</a> Job Arguments</h3> <p>Jobs accept three types of arguments:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token function">workflow</span><span class="token punctuation">(</span>
    <span class="token argument-name">example</span><span class="token punctuation">:</span> <span class="token function">sync</span><span class="token punctuation">(</span>
        <span class="token class-name static-context">MyAction</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">,</span>
        <span class="token argument-name">literal</span><span class="token punctuation">:</span> <span class="token string single-quoted-string">'fixed value'</span><span class="token punctuation">,</span>           <span class="token comment">// Literal value</span>
        dynamic<span class="token punctuation">:</span> <span class="token function">variable</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'userInput'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>   <span class="token comment">// Runtime variable</span>
        chained<span class="token punctuation">:</span> <span class="token function">response</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'otherJob'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token comment">// Previous job output</span>
    <span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Jobs can define I/O rules via <a href="https://chevere.org/packages/parameter" target="_blank" rel="noopener noreferrer">chevere/parameter<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. Workflow derives parameter and return definitions from the closure signature or Action reflection, and validates inputs and responses at runtime.</p> <hr> <h2 id="variables"><a href="#variables" class="header-anchor">#</a> Variables</h2> <p>Variables are placeholders for values provided at runtime. Declare them with <code>variable()</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$workflow</span> <span class="token operator">=</span> <span class="token function">workflow</span><span class="token punctuation">(</span>
    <span class="token argument-name">job1</span><span class="token punctuation">:</span> <span class="token function">sync</span><span class="token punctuation">(</span>
        <span class="token class-name static-context">SomeAction</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">,</span>
        <span class="token argument-name">name</span><span class="token punctuation">:</span> <span class="token function">variable</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'userName'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token argument-name">age</span><span class="token punctuation">:</span> <span class="token function">variable</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'userAge'</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Provide values when running</span>
<span class="token variable">$result</span> <span class="token operator">=</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token variable">$workflow</span><span class="token punctuation">,</span> <span class="token argument-name">userName</span><span class="token punctuation">:</span> <span class="token string single-quoted-string">'Alice'</span><span class="token punctuation">,</span> <span class="token argument-name">userAge</span><span class="token punctuation">:</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>All declared variables must be provided when running the workflow.</p> <hr> <h2 id="responses"><a href="#responses" class="header-anchor">#</a> Responses</h2> <p>Use <code>response()</code> to pass output from one job to another. This automatically establishes a dependency.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$workflow</span> <span class="token operator">=</span> <span class="token function">workflow</span><span class="token punctuation">(</span>
    <span class="token argument-name">fetch</span><span class="token punctuation">:</span> <span class="token function">sync</span><span class="token punctuation">(</span>
        <span class="token class-name static-context">FetchData</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">,</span>
        <span class="token argument-name">url</span><span class="token punctuation">:</span> <span class="token function">variable</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'endpoint'</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token argument-name">process</span><span class="token punctuation">:</span> <span class="token function">sync</span><span class="token punctuation">(</span>
        <span class="token class-name static-context">ProcessData</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">,</span>
        <span class="token argument-name">data</span><span class="token punctuation">:</span> <span class="token function">response</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'fetch'</span><span class="token punctuation">)</span>  <span class="token comment">// Gets entire response from 'fetch'</span>
    <span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token argument-name">extract</span><span class="token punctuation">:</span> <span class="token function">sync</span><span class="token punctuation">(</span>
        <span class="token class-name static-context">ExtractField</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">,</span>
        <span class="token argument-name">value</span><span class="token punctuation">:</span> <span class="token function">response</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'fetch'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'items'</span><span class="token punctuation">)</span>  <span class="token comment">// Gets 'items' key from response</span>
    <span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="accessing-nested-response-keys"><a href="#accessing-nested-response-keys" class="header-anchor">#</a> Accessing Nested Response Keys</h3> <p>When a job returns an array, access specific keys:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token function">response</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'user'</span><span class="token punctuation">)</span>           <span class="token comment">// Entire response</span>
<span class="token function">response</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'user'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'id'</span><span class="token punctuation">)</span>     <span class="token comment">// $response['id']</span>
<span class="token function">response</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'user'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'profile'</span><span class="token punctuation">)</span> <span class="token comment">// $response['profile']</span>
</code></pre></div><hr> <h2 id="execution-graph"><a href="#execution-graph" class="header-anchor">#</a> Execution Graph</h2> <p>The workflow engine automatically builds an execution graph based on job dependencies. Jobs without dependencies run in parallel (when using <code>async</code>), while dependent jobs wait for their dependencies.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$workflow</span> <span class="token operator">=</span> <span class="token function">workflow</span><span class="token punctuation">(</span>
    <span class="token comment">// Independent async jobs run in parallel</span>
    thumb<span class="token punctuation">:</span> <span class="token function">async</span><span class="token punctuation">(</span><span class="token class-name static-context">ImageResize</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token argument-name">size</span><span class="token punctuation">:</span> <span class="token string single-quoted-string">'thumb'</span><span class="token punctuation">,</span> <span class="token argument-name">file</span><span class="token punctuation">:</span> <span class="token function">variable</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'image'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token argument-name">medium</span><span class="token punctuation">:</span> <span class="token function">async</span><span class="token punctuation">(</span><span class="token class-name static-context">ImageResize</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token argument-name">size</span><span class="token punctuation">:</span> <span class="token string single-quoted-string">'medium'</span><span class="token punctuation">,</span> <span class="token argument-name">file</span><span class="token punctuation">:</span> <span class="token function">variable</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'image'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token argument-name">large</span><span class="token punctuation">:</span> <span class="token function">async</span><span class="token punctuation">(</span><span class="token class-name static-context">ImageResize</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token argument-name">size</span><span class="token punctuation">:</span> <span class="token string single-quoted-string">'large'</span><span class="token punctuation">,</span> <span class="token argument-name">file</span><span class="token punctuation">:</span> <span class="token function">variable</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'image'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment">// Sync job waits for all above</span>
    store<span class="token punctuation">:</span> <span class="token function">sync</span><span class="token punctuation">(</span>
        <span class="token class-name static-context">StoreFiles</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">,</span>
        <span class="token argument-name">thumb</span><span class="token punctuation">:</span> <span class="token function">response</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'thumb'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token argument-name">medium</span><span class="token punctuation">:</span> <span class="token function">response</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'medium'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token argument-name">large</span><span class="token punctuation">:</span> <span class="token function">response</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'large'</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// View the execution graph</span>
<span class="token variable">$graph</span> <span class="token operator">=</span> <span class="token variable">$workflow</span><span class="token operator">-&gt;</span><span class="token function">jobs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">graph</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// [</span>
<span class="token comment">//     ['thumb', 'medium', 'large'],  // Level 0: parallel</span>
<span class="token comment">//     ['store']                       // Level 1: after dependencies</span>
<span class="token comment">// ]</span>
</code></pre></div><div class="language-mermaid extra-class"><pre class="language-mermaid"><code><span class="token keyword">graph</span> TD
    thumb <span class="token arrow operator">--&gt;</span> store
    medium <span class="token arrow operator">--&gt;</span> store
    large <span class="token arrow operator">--&gt;</span> store
</code></pre></div><hr> <h2 id="running-workflows"><a href="#running-workflows" class="header-anchor">#</a> Running Workflows</h2> <p>Execute a workflow with the <code>run()</code> function:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token keyword">function</span> <span class="token package">Chevere<span class="token punctuation">\</span>Workflow<span class="token punctuation">\</span>run</span><span class="token punctuation">;</span>

<span class="token comment">// Basic execution</span>
<span class="token variable">$result</span> <span class="token operator">=</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token variable">$workflow</span><span class="token punctuation">,</span> <span class="token argument-name">var1</span><span class="token punctuation">:</span> <span class="token string single-quoted-string">'value1'</span><span class="token punctuation">,</span> <span class="token argument-name">var2</span><span class="token punctuation">:</span> <span class="token string single-quoted-string">'value2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// With dependency injection container</span>
<span class="token variable">$result</span> <span class="token operator">=</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token variable">$workflow</span><span class="token punctuation">,</span> <span class="token variable">$container</span><span class="token punctuation">,</span> <span class="token argument-name">var1</span><span class="token punctuation">:</span> <span class="token string single-quoted-string">'value1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="accessing-responses"><a href="#accessing-responses" class="header-anchor">#</a> Accessing Responses</h3> <p>The run result provides type-safe access to job responses:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$result</span> <span class="token operator">=</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token variable">$workflow</span><span class="token punctuation">,</span> <span class="token operator">...</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Get typed responses</span>
<span class="token variable">$result</span><span class="token operator">-&gt;</span><span class="token function">response</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'jobName'</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token keyword type-declaration">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">// string</span>
<span class="token variable">$result</span><span class="token operator">-&gt;</span><span class="token function">response</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'jobName'</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token keyword type-declaration">int</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// int</span>
<span class="token variable">$result</span><span class="token operator">-&gt;</span><span class="token function">response</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'jobName'</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token keyword type-declaration">float</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">// float</span>
<span class="token variable">$result</span><span class="token operator">-&gt;</span><span class="token function">response</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'jobName'</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token keyword type-declaration">bool</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token comment">// bool</span>
<span class="token variable">$result</span><span class="token operator">-&gt;</span><span class="token function">response</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'jobName'</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">// array</span>

<span class="token comment">// Access array keys directly</span>
<span class="token variable">$result</span><span class="token operator">-&gt;</span><span class="token function">response</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'jobName'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'key'</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token keyword type-declaration">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$result</span><span class="token operator">-&gt;</span><span class="token function">response</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'jobName'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'nested'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'key'</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token keyword type-declaration">int</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="check-skipped-jobs"><a href="#check-skipped-jobs" class="header-anchor">#</a> Check Skipped Jobs</h3> <p>When using conditional execution, check which jobs were skipped:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$result</span><span class="token operator">-&gt;</span><span class="token function">skip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'optionalJob'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Job was skipped</span>
<span class="token punctuation">}</span>
</code></pre></div><hr> <h2 id="conditional-execution"><a href="#conditional-execution" class="header-anchor">#</a> Conditional Execution</h2> <p>Use <code>withRunIf()</code> to run a job only when conditions are met:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$workflow</span> <span class="token operator">=</span> <span class="token function">workflow</span><span class="token punctuation">(</span>
    <span class="token argument-name">compress</span><span class="token punctuation">:</span> <span class="token function">sync</span><span class="token punctuation">(</span>
        <span class="token class-name static-context">CompressImage</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">,</span>
        <span class="token argument-name">file</span><span class="token punctuation">:</span> <span class="token function">variable</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">withRunIf</span><span class="token punctuation">(</span>
        <span class="token function">variable</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'shouldCompress'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>           <span class="token comment">// Must be truthy</span>
        <span class="token function">response</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'validate'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'isValid'</span><span class="token punctuation">)</span>       <span class="token comment">// Must be truthy</span>
    <span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$result</span> <span class="token operator">=</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token variable">$workflow</span><span class="token punctuation">,</span>
    <span class="token argument-name">file</span><span class="token punctuation">:</span> <span class="token string single-quoted-string">'/path/to/image.jpg'</span><span class="token punctuation">,</span>
    <span class="token argument-name">shouldCompress</span><span class="token punctuation">:</span> <span class="token constant boolean">true</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>All conditions must be truthy for the job to run. Skipped jobs are tracked in <code>$result-&gt;skip()</code>.</p> <hr> <h2 id="explicit-dependencies"><a href="#explicit-dependencies" class="header-anchor">#</a> Explicit Dependencies</h2> <p>While <code>response()</code> creates implicit dependencies, use <code>withDepends()</code> for explicit control:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$workflow</span> <span class="token operator">=</span> <span class="token function">workflow</span><span class="token punctuation">(</span>
    <span class="token argument-name">setup</span><span class="token punctuation">:</span> <span class="token function">sync</span><span class="token punctuation">(</span><span class="token class-name static-context">SetupAction</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token argument-name">process</span><span class="token punctuation">:</span> <span class="token function">sync</span><span class="token punctuation">(</span>
        <span class="token class-name static-context">ProcessAction</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">,</span>
        <span class="token argument-name">data</span><span class="token punctuation">:</span> <span class="token function">variable</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'input'</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">withDepends</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'setup'</span><span class="token punctuation">)</span>  <span class="token comment">// Wait for setup even without using its response</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><hr> <h2 id="retry-policy"><a href="#retry-policy" class="header-anchor">#</a> Retry Policy</h2> <p>Configure automatic retries for jobs that may fail transiently:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$workflow</span> <span class="token operator">=</span> <span class="token function">workflow</span><span class="token punctuation">(</span>
    <span class="token argument-name">fetch</span><span class="token punctuation">:</span> <span class="token function">sync</span><span class="token punctuation">(</span>
        <span class="token class-name static-context">FetchFromApi</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">,</span>
        <span class="token argument-name">url</span><span class="token punctuation">:</span> <span class="token function">variable</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'endpoint'</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">withRetry</span><span class="token punctuation">(</span>
        <span class="token argument-name">timeout</span><span class="token punctuation">:</span> <span class="token number">300</span><span class="token punctuation">,</span>     <span class="token comment">// Max 300 seconds total</span>
        maxAttempts<span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">,</span>   <span class="token comment">// Try up to 5 times</span>
        delay<span class="token punctuation">:</span> <span class="token number">10</span>         <span class="token comment">// Wait 10 seconds between attempts</span>
    <span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><table><thead><tr><th>Parameter</th> <th>Type</th> <th>Default</th> <th>Description</th></tr></thead> <tbody><tr><td><code>timeout</code></td> <td><code>int&lt;0, max&gt;</code></td> <td><code>0</code></td> <td>Max execution time in seconds (0 = unlimited)</td></tr> <tr><td><code>maxAttempts</code></td> <td><code>int&lt;1, max&gt;</code></td> <td><code>1</code></td> <td>Total attempts including initial</td></tr> <tr><td><code>delay</code></td> <td><code>int&lt;0, max&gt;</code></td> <td><code>0</code></td> <td>Seconds between retries (0 = immediate)</td></tr></tbody></table> <p>Retry delays use non-blocking sleep, making them safe for async runtimes.</p> <hr> <h2 id="exception-handling"><a href="#exception-handling" class="header-anchor">#</a> Exception Handling</h2> <p>When a job fails, a <code>WorkflowException</code> wraps the original exception:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">Chevere<span class="token punctuation">\</span>Workflow<span class="token punctuation">\</span>Exceptions<span class="token punctuation">\</span>WorkflowException</span><span class="token punctuation">;</span>

<span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token variable">$result</span> <span class="token operator">=</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token variable">$workflow</span><span class="token punctuation">,</span> <span class="token operator">...</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">WorkflowException</span> <span class="token variable">$e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">echo</span> <span class="token variable">$e</span><span class="token operator">-&gt;</span><span class="token property">name</span><span class="token punctuation">;</span>        <span class="token comment">// Name of the failed job</span>
    <span class="token keyword">echo</span> <span class="token variable">$e</span><span class="token operator">-&gt;</span><span class="token property">job</span><span class="token punctuation">;</span>         <span class="token comment">// Job instance</span>
    <span class="token keyword">echo</span> <span class="token variable">$e</span><span class="token operator">-&gt;</span><span class="token property">throwable</span><span class="token punctuation">;</span>   <span class="token comment">// Original exception</span>
<span class="token punctuation">}</span>
</code></pre></div><hr> <h2 id="using-workflowtrait"><a href="#using-workflowtrait" class="header-anchor">#</a> Using WorkflowTrait</h2> <p>For class-based workflow management, use <code>WorkflowTrait</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">Chevere<span class="token punctuation">\</span>Workflow<span class="token punctuation">\</span>Traits<span class="token punctuation">\</span>WorkflowTrait</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">function</span> Chevere\Workflow\<span class="token punctuation">{</span>workflow<span class="token punctuation">,</span> sync<span class="token punctuation">,</span> variable<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name-definition class-name">OrderProcessor</span>
<span class="token punctuation">{</span>
    <span class="token keyword">use</span> <span class="token package">WorkflowTrait</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">process</span><span class="token punctuation">(</span><span class="token keyword type-hint">int</span> <span class="token variable">$orderId</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword return-type">void</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$workflow</span> <span class="token operator">=</span> <span class="token function">workflow</span><span class="token punctuation">(</span>
            <span class="token argument-name">validate</span><span class="token punctuation">:</span> <span class="token function">sync</span><span class="token punctuation">(</span><span class="token class-name static-context">ValidateOrder</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token argument-name">id</span><span class="token punctuation">:</span> <span class="token function">variable</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'orderId'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token argument-name">charge</span><span class="token punctuation">:</span> <span class="token function">sync</span><span class="token punctuation">(</span><span class="token class-name static-context">ChargePayment</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token argument-name">order</span><span class="token punctuation">:</span> <span class="token function">response</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'validate'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token argument-name">fulfill</span><span class="token punctuation">:</span> <span class="token function">sync</span><span class="token punctuation">(</span><span class="token class-name static-context">FulfillOrder</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token argument-name">order</span><span class="token punctuation">:</span> <span class="token function">response</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'charge'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token variable">$workflow</span><span class="token punctuation">,</span> <span class="token argument-name">orderId</span><span class="token punctuation">:</span> <span class="token variable">$orderId</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">getResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword return-type">string</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">response</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'fulfill'</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token keyword type-declaration">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><hr> <h2 id="testing"><a href="#testing" class="header-anchor">#</a> Testing</h2> <h3 id="testing-actions"><a href="#testing-actions" class="header-anchor">#</a> Testing Actions</h3> <p>Test your Action classes independently:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">PHPUnit<span class="token punctuation">\</span>Framework<span class="token punctuation">\</span>TestCase</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name-definition class-name">FetchUserTest</span> <span class="token keyword">extends</span> <span class="token class-name">TestCase</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">testFetchUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword return-type">void</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$action</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FetchUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$result</span> <span class="token operator">=</span> <span class="token variable">$action</span><span class="token punctuation">(</span><span class="token argument-name">userId</span><span class="token punctuation">:</span> <span class="token number">123</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">assertSame</span><span class="token punctuation">(</span><span class="token number">123</span><span class="token punctuation">,</span> <span class="token variable">$result</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">assertArrayHasKey</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">,</span> <span class="token variable">$result</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="testing-workflow-graph"><a href="#testing-workflow-graph" class="header-anchor">#</a> Testing Workflow Graph</h3> <p>Verify execution order:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">testWorkflowGraph</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword return-type">void</span>
<span class="token punctuation">{</span>
    <span class="token variable">$workflow</span> <span class="token operator">=</span> <span class="token function">workflow</span><span class="token punctuation">(</span>
        <span class="token argument-name">a</span><span class="token punctuation">:</span> <span class="token function">async</span><span class="token punctuation">(</span><span class="token class-name static-context">ActionA</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token argument-name">b</span><span class="token punctuation">:</span> <span class="token function">async</span><span class="token punctuation">(</span><span class="token class-name static-context">ActionB</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token argument-name">c</span><span class="token punctuation">:</span> <span class="token function">sync</span><span class="token punctuation">(</span><span class="token class-name static-context">ActionC</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token argument-name">x</span><span class="token punctuation">:</span> <span class="token function">response</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'a'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token argument-name">y</span><span class="token punctuation">:</span> <span class="token function">response</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'b'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token variable">$graph</span> <span class="token operator">=</span> <span class="token variable">$workflow</span><span class="token operator">-&gt;</span><span class="token function">jobs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">graph</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">assertSame</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'a'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'b'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string single-quoted-string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$graph</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="testing-responses"><a href="#testing-responses" class="header-anchor">#</a> Testing Responses</h3> <p>Test complete workflow execution:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">testWorkflowResponses</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword return-type">void</span>
<span class="token punctuation">{</span>
    <span class="token variable">$result</span> <span class="token operator">=</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token variable">$workflow</span><span class="token punctuation">,</span> <span class="token argument-name">input</span><span class="token punctuation">:</span> <span class="token string single-quoted-string">'test'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">assertSame</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'expected'</span><span class="token punctuation">,</span> <span class="token variable">$result</span><span class="token operator">-&gt;</span><span class="token function">response</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'job1'</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token keyword type-declaration">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">assertSame</span><span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">,</span> <span class="token variable">$result</span><span class="token operator">-&gt;</span><span class="token function">response</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'job2'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'count'</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token keyword type-declaration">int</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="testing-exceptions"><a href="#testing-exceptions" class="header-anchor">#</a> Testing Exceptions</h3> <p>Use <code>ExpectWorkflowExceptionTrait</code> for error scenarios:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">Chevere<span class="token punctuation">\</span>Workflow<span class="token punctuation">\</span>Traits<span class="token punctuation">\</span>ExpectWorkflowExceptionTrait</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name-definition class-name">WorkflowExceptionTest</span> <span class="token keyword">extends</span> <span class="token class-name">TestCase</span>
<span class="token punctuation">{</span>
    <span class="token keyword">use</span> <span class="token package">ExpectWorkflowExceptionTrait</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">testJobFailure</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword return-type">void</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">expectWorkflowException</span><span class="token punctuation">(</span>
            <span class="token argument-name">closure</span><span class="token punctuation">:</span> <span class="token keyword">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token variable">$workflow</span><span class="token punctuation">,</span> <span class="token argument-name">input</span><span class="token punctuation">:</span> <span class="token string single-quoted-string">'invalid'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token argument-name">exception</span><span class="token punctuation">:</span> <span class="token class-name static-context">InvalidArgumentException</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">,</span>
            <span class="token argument-name">job</span><span class="token punctuation">:</span> <span class="token string single-quoted-string">'validate'</span><span class="token punctuation">,</span>
            <span class="token argument-name">message</span><span class="token punctuation">:</span> <span class="token string single-quoted-string">'Invalid input provided'</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><hr> <h2 id="real-world-examples"><a href="#real-world-examples" class="header-anchor">#</a> Real-World Examples</h2> <h3 id="image-processing-pipeline"><a href="#image-processing-pipeline" class="header-anchor">#</a> Image Processing Pipeline</h3> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$workflow</span> <span class="token operator">=</span> <span class="token function">workflow</span><span class="token punctuation">(</span>
    <span class="token comment">// Parallel image resizing</span>
    thumb<span class="token punctuation">:</span> <span class="token function">async</span><span class="token punctuation">(</span>
        <span class="token class-name static-context">ImageResize</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">,</span>
        <span class="token argument-name">file</span><span class="token punctuation">:</span> <span class="token function">variable</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'image'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token argument-name">width</span><span class="token punctuation">:</span> <span class="token number">150</span><span class="token punctuation">,</span>
        <span class="token argument-name">height</span><span class="token punctuation">:</span> <span class="token number">150</span>
    <span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token argument-name">medium</span><span class="token punctuation">:</span> <span class="token function">async</span><span class="token punctuation">(</span>
        <span class="token class-name static-context">ImageResize</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">,</span>
        <span class="token argument-name">file</span><span class="token punctuation">:</span> <span class="token function">variable</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'image'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token argument-name">width</span><span class="token punctuation">:</span> <span class="token number">800</span>
    <span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment">// Store after all resizing completes</span>
    store<span class="token punctuation">:</span> <span class="token function">sync</span><span class="token punctuation">(</span>
        <span class="token class-name static-context">StoreFiles</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">,</span>
        <span class="token argument-name">thumb</span><span class="token punctuation">:</span> <span class="token function">response</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'thumb'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token argument-name">medium</span><span class="token punctuation">:</span> <span class="token function">response</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'medium'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token argument-name">directory</span><span class="token punctuation">:</span> <span class="token function">variable</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'outputDir'</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$result</span> <span class="token operator">=</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token variable">$workflow</span><span class="token punctuation">,</span>
    <span class="token argument-name">image</span><span class="token punctuation">:</span> <span class="token string single-quoted-string">'/uploads/photo.jpg'</span><span class="token punctuation">,</span>
    <span class="token argument-name">outputDir</span><span class="token punctuation">:</span> <span class="token string single-quoted-string">'/processed/'</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="user-registration-flow"><a href="#user-registration-flow" class="header-anchor">#</a> User Registration Flow</h3> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$workflow</span> <span class="token operator">=</span> <span class="token function">workflow</span><span class="token punctuation">(</span>
    <span class="token argument-name">validate</span><span class="token punctuation">:</span> <span class="token function">sync</span><span class="token punctuation">(</span>
        <span class="token class-name static-context">ValidateRegistration</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">,</span>
        <span class="token argument-name">email</span><span class="token punctuation">:</span> <span class="token function">variable</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'email'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token argument-name">password</span><span class="token punctuation">:</span> <span class="token function">variable</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'password'</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token argument-name">createUser</span><span class="token punctuation">:</span> <span class="token function">sync</span><span class="token punctuation">(</span>
        <span class="token class-name static-context">CreateUser</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">,</span>
        <span class="token argument-name">data</span><span class="token punctuation">:</span> <span class="token function">response</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'validate'</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token argument-name">sendWelcome</span><span class="token punctuation">:</span> <span class="token function">async</span><span class="token punctuation">(</span>
        <span class="token class-name static-context">SendWelcomeEmail</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">,</span>
        <span class="token argument-name">user</span><span class="token punctuation">:</span> <span class="token function">response</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'createUser'</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token argument-name">logEvent</span><span class="token punctuation">:</span> <span class="token function">async</span><span class="token punctuation">(</span>
        <span class="token class-name static-context">LogRegistration</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">,</span>
        <span class="token argument-name">userId</span><span class="token punctuation">:</span> <span class="token function">response</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'createUser'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'id'</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="conditional-processing"><a href="#conditional-processing" class="header-anchor">#</a> Conditional Processing</h3> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$workflow</span> <span class="token operator">=</span> <span class="token function">workflow</span><span class="token punctuation">(</span>
    <span class="token argument-name">analyze</span><span class="token punctuation">:</span> <span class="token function">sync</span><span class="token punctuation">(</span>
        <span class="token class-name static-context">AnalyzeContent</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">,</span>
        <span class="token argument-name">content</span><span class="token punctuation">:</span> <span class="token function">variable</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'text'</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token argument-name">translate</span><span class="token punctuation">:</span> <span class="token function">sync</span><span class="token punctuation">(</span>
        <span class="token class-name static-context">TranslateContent</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">,</span>
        <span class="token argument-name">text</span><span class="token punctuation">:</span> <span class="token function">variable</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'text'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token argument-name">targetLang</span><span class="token punctuation">:</span> <span class="token function">variable</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'lang'</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">withRunIf</span><span class="token punctuation">(</span>
        <span class="token function">variable</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'needsTranslation'</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token argument-name">publish</span><span class="token punctuation">:</span> <span class="token function">sync</span><span class="token punctuation">(</span>
        <span class="token class-name static-context">PublishContent</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">,</span>
        <span class="token argument-name">content</span><span class="token punctuation">:</span> <span class="token function">response</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'analyze'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token argument-name">translated</span><span class="token punctuation">:</span> <span class="token function">response</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'translate'</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$result</span> <span class="token operator">=</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token variable">$workflow</span><span class="token punctuation">,</span>
    <span class="token argument-name">text</span><span class="token punctuation">:</span> <span class="token string single-quoted-string">'Hello world'</span><span class="token punctuation">,</span>
    <span class="token argument-name">lang</span><span class="token punctuation">:</span> <span class="token string single-quoted-string">'es'</span><span class="token punctuation">,</span>
    <span class="token argument-name">needsTranslation</span><span class="token punctuation">:</span> <span class="token constant boolean">true</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/chevere/docs/edit/main/packages/workflow.md" target="_blank" rel="noopener noreferrer">Edit this page</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.d34653bd.js" defer></script><script src="/assets/js/2.b3d98ebb.js" defer></script><script src="/assets/js/1.cbf95cfe.js" defer></script><script src="/assets/js/52.78353147.js" defer></script>
  </body>
</html>
